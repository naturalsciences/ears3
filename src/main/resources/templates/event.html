<!DOCTYPE html>
<html lang="en">
    <!--HTML5 doctype -->
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
              integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk"
              crossorigin="anonymous">
        <link rel="stylesheet" type="text/css"href="css/bootstrap-select.css">
        <link rel="stylesheet" type="text/css"href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
        <link rel="stylesheet" type="text/css" href="css/style.css" >
        <title>Create new events</title>
    </head>
    <body>
        <nav class="navbar navbar-expand-md navbar-light ">
            <div class="container"> <a class="navbar-brand text-primary" href="#">
                    <i class="fa d-inline fa-lg fa-stop-circle"></i>
                    <b>EARS</b> 
                    <a class="nav-link disabled" id="firstNameLabel" href="#"></a>
                    <a class="nav-link disabled" id="lastNameLabel" href="#"></a>
                    <a class="nav-link disabled" id="programLabel" href="#"></a>
                    <button class="navbar-toggler navbar-toggler-right border-0" type="button"
                            data-toggle="collapse" data-target="#navbar4">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbar4">
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item"> <a class="nav-link" href="./login">Settings</a> </li>
                            <li class="nav-item"> <a class="nav-link" href="./event">Event</a> </li>
                            <li class="nav-item"> <a class="nav-link" href="./events">Events</a> </li>
                        </ul>
                    </div>
            </div>
        </nav>


        <div class="container">
            <div class="row">
                <div class="col-sm-12">
                    <!--    <div class='alert alert-danger' role='alert' id="id_form_process">All list must be selected.</div>-->
                    <div class="alert alert-info" role="alert" id="id_eid"></div>
                </div>
            </div>

            <!--Recent Event by Accordeon module-->
            <div class="accordion" id="id_accordion">
                <div class="card">
                    <div class="card-header" id="headingOne">
                        <h2 class="mb-0">
                            <button id="id_collapse_button" class="btn btn-link btn-block text-left" type="button"
                                    data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" 
                                    aria-controls="collapseOne">
                                Recent Events
                                <svg id="id_collapse_in" width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-down pull-right" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                                </svg>

                                <svg id="id_collapse_out" width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-up  pull-right" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"/>
                                </svg>
                            </button>
                        </h2>
                    </div>

                    <div id="collapseOne" class="collapse show " aria-labelledby="headingOne" data-parent="#id_accordion">
                        <form role="form" class="class_form">
                            <table id="recentEvents" class="table  table-hover  table-sm" style="margin: 0 auto; ">                     
                                <!--table-bordered-->
                            </table>
                        </form>
                    </div>
                </div>
            </div>

            <form role="form" class="class_form" method="POST">
                <table class="table" id="laTable">
                    <!--table-bordered-->
                    <tbody>
                        <tr id="tr_tc">
                            <td class="col-3 col-sm-1">ToolCategory</td>
                            <td class="col-3 col-sm-9"> <select name="clcu" id="idSelect_tc"
                                                                class="selectpicker target  form-control"
                                                                data-live-search="true" data-with="auto">
                                </select>
                            </td>
                            <td class="col-6 col-sm-2 cell_hover" id="cell_tc_unlock"> <svg id="tc_unlock"
                                                                                            width="1em" height="1em" viewBox="0 0 16 16"
                                                                                            class="bi bi-unlock" fill="green"
                                                                                            xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M9.655 8H2.333c-.264 0-.398.068-.471.121a.73.73 0 0 0-.224.296 1.626 1.626 0 0 0-.138.59V14c0 .342.076.531.14.635.064.106.151.18.256.237a1.122 1.122 0 0 0 .436.127l.013.001h7.322c.264 0 .398-.068.471-.121a.73.73 0 0 0 .224-.296 1.627 1.627 0 0 0 .138-.59V9c0-.342-.076-.531-.14-.635a.658.658 0 0 0-.255-.237A1.122 1.122 0 0 0 9.655 8zm.012-1H2.333C.5 7 .5 9 .5 9v5c0 2 1.833 2 1.833 2h7.334c1.833 0 1.833-2 1.833-2V9c0-2-1.833-2-1.833-2zM8.5 4a3.5 3.5 0 1 1 7 0v3h-1V4a2.5 2.5 0 0 0-5 0v3h-1V4z" />
                                </svg>

                                <svg id="tc_lock" width="1em" height="1em" viewBox="0 0 16 16"
                                     class="bi bi-lock" fill="red"
                                     xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M11.5 8h-7a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1zm-7-1a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-7zm0-3a3.5 3.5 0 1 1 7 0v3h-1V4a2.5 2.5 0 0 0-5 0v3h-1V4z" />
                                </svg>

                                <svg class="succesSended bi bi-check-circle-fill" width="1em" height="1em" viewBox="0 0 16 16"
                                     fill="green"
                                     xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                                </svg>
                            </td>
                        </tr>
                        <tr id="tr_t">
                            <td class="col-3 col-sm-1">Tool</td>
                            <td class="col-3 col-sm-9"> <select name="tltu" id="idSelect_t"
                                                                class="selectpicker target  form-control"
                                                                data-live-search="true">

                                </select></td>
                            <td class="col-6 col-sm-2 cell_hover" id="cell_t_unlock"> <svg id="t_unlock"
                                                                                           width="1em" height="1em" viewBox="0 0 16 16"
                                                                                           class="bi bi-unlock" fill="green"
                                                                                           xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M9.655 8H2.333c-.264 0-.398.068-.471.121a.73.73 0 0 0-.224.296 1.626 1.626 0 0 0-.138.59V14c0 .342.076.531.14.635.064.106.151.18.256.237a1.122 1.122 0 0 0 .436.127l.013.001h7.322c.264 0 .398-.068.471-.121a.73.73 0 0 0 .224-.296 1.627 1.627 0 0 0 .138-.59V9c0-.342-.076-.531-.14-.635a.658.658 0 0 0-.255-.237A1.122 1.122 0 0 0 9.655 8zm.012-1H2.333C.5 7 .5 9 .5 9v5c0 2 1.833 2 1.833 2h7.334c1.833 0 1.833-2 1.833-2V9c0-2-1.833-2-1.833-2zM8.5 4a3.5 3.5 0 1 1 7 0v3h-1V4a2.5 2.5 0 0 0-5 0v3h-1V4z" />
                                </svg>

                                <svg id="t_lock" width="1em" height="1em" viewBox="0 0 16 16"
                                     class="bi bi-lock" fill="red"
                                     xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M11.5 8h-7a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1zm-7-1a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-7zm0-3a3.5 3.5 0 1 1 7 0v3h-1V4a2.5 2.5 0 0 0-5 0v3h-1V4z" />
                                </svg>
                                <svg class="succesSended bi bi-check-circle-fill" width="1em" height="1em" viewBox="0 0 16 16"
                                     fill="green"
                                     xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                                </svg>

                            </td>
                        </tr>
                        <tr id="tr_p">
                            <td class="col-3 col-sm-1">Process</td>
                            <td class="col-3 col-sm-9"><select name="plpu" id="idSelect_p"
                                                               class="selectpicker target  form-control"
                                                               data-live-search="true">

                                </select></td>
                            <td class="col-6 col-sm-2 cell_hover" id="cell_p_unlock"> <svg id="p_unlock"
                                                                                           width="1em" height="1em" viewBox="0 0 16 16"
                                                                                           class="bi bi-unlock" fill="green"
                                                                                           xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M9.655 8H2.333c-.264 0-.398.068-.471.121a.73.73 0 0 0-.224.296 1.626 1.626 0 0 0-.138.59V14c0 .342.076.531.14.635.064.106.151.18.256.237a1.122 1.122 0 0 0 .436.127l.013.001h7.322c.264 0 .398-.068.471-.121a.73.73 0 0 0 .224-.296 1.627 1.627 0 0 0 .138-.59V9c0-.342-.076-.531-.14-.635a.658.658 0 0 0-.255-.237A1.122 1.122 0 0 0 9.655 8zm.012-1H2.333C.5 7 .5 9 .5 9v5c0 2 1.833 2 1.833 2h7.334c1.833 0 1.833-2 1.833-2V9c0-2-1.833-2-1.833-2zM8.5 4a3.5 3.5 0 1 1 7 0v3h-1V4a2.5 2.5 0 0 0-5 0v3h-1V4z" />
                                </svg>

                                <svg id="p_lock" width="1em" height="1em" viewBox="0 0 16 16"
                                     class="bi bi-lock" fill="red"
                                     xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M11.5 8h-7a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1zm-7-1a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-7zm0-3a3.5 3.5 0 1 1 7 0v3h-1V4a2.5 2.5 0 0 0-5 0v3h-1V4z" />
                                </svg>
                                <svg class="succesSended bi bi-check-circle-fill" width="1em" height="1em" viewBox="0 0 16 16"
                                     fill="green"
                                     xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                                </svg>
                            </td>
                        </tr>
                        <tr id="tr_a">
                            <td class="col-3 col-sm-1">Action</td>
                            <td class="col-3 col-sm-9"><select name="alau" id="idSelect_a"
                                                               class="selectpicker target  form-control"
                                                               data-live-search="true">

                                </select></td>
                            <td class="col-6 col-sm-2 cell_hover" id="cell_a_unlock">
                                <svg id="a_unlock" width="1em" height="1em" viewBox="0 0 16 16"
                                     class="bi bi-unlock" fill="green"
                                     xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M9.655 8H2.333c-.264 0-.398.068-.471.121a.73.73 0 0 0-.224.296 1.626 1.626 0 0 0-.138.59V14c0 .342.076.531.14.635.064.106.151.18.256.237a1.122 1.122 0 0 0 .436.127l.013.001h7.322c.264 0 .398-.068.471-.121a.73.73 0 0 0 .224-.296 1.627 1.627 0 0 0 .138-.59V9c0-.342-.076-.531-.14-.635a.658.658 0 0 0-.255-.237A1.122 1.122 0 0 0 9.655 8zm.012-1H2.333C.5 7 .5 9 .5 9v5c0 2 1.833 2 1.833 2h7.334c1.833 0 1.833-2 1.833-2V9c0-2-1.833-2-1.833-2zM8.5 4a3.5 3.5 0 1 1 7 0v3h-1V4a2.5 2.5 0 0 0-5 0v3h-1V4z" />
                                </svg>

                                <svg id="a_lock" width="1em" height="1em" viewBox="0 0 16 16"
                                     class="bi bi-lock" fill="red"
                                     xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M11.5 8h-7a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1zm-7-1a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-7zm0-3a3.5 3.5 0 1 1 7 0v3h-1V4a2.5 2.5 0 0 0-5 0v3h-1V4z" />
                                </svg>

                                <svg class="succesSended bi bi-check-circle-fill" width="1em" height="1em" viewBox="0 0 16 16"
                                     fill="green"
                                     xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                                </svg>
                            </td>
                        </tr>

                    </tbody>
                </table>
                <div class="row">
                    <div class="col-sm-12">
                        <button id="idSubmit" type="submit"
                                class="btn btn-primary btn-lg btn-block">Submit</button>
                        <!--if alles = 1 => pas correct -->


                        <!--  <div class="col-md-4">
                               <div class="btn-group w-100 p-3 btn-group-lg h-50">
                                      <button id="idPost" type="submit" class="btn btn-primary">Post</button>
                               //if alles = 1 => pas correct                                          </div>
                        
                        </div>-->
                    </div>
                </div>
            </form>

            <div id="div1" style="width:80px;height:80px;display:none;background-color:red;"></div><br>
            <div id="success-alert"></div>
            <!--accordeon-->
        </div>

        <!--pour optimisation ne pas toucher les scripts ci dessous -->
        <script src="js/jquery-3.5.1.js"></script>
        <!--production reference  <script src="jquery-3.5.1.min.js"></script>
 <script src="utilJQuery.js"></script>-->
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
                integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
                integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
        crossorigin="anonymous"></script>
        <script src="js/bootstrap-select.js"></script>
        <script>
            // https://developer.mozilla.org/fr/docs/Web/API/Web_Storage_API

            var eventPostLocation = "../event";
            var rdfLocation = "ontology/vessel/sparql?q=PREFIX%20owl%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2002%2F07%2Fowl%23%3E%0APREFIX%20dc%3A%20%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Felements%2F1.1%2F%3E%0APREFIX%20skos%3A%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0APREFIX%20ears2%3A%3Chttp%3A%2F%2Fontologies.ef-ears.eu%2Fears2%2F1%23%3E%0APREFIX%20xsd%3A%3Chttp%3A%2F%2Fwww.w3.org%2F2001%2FXMLSchema%23%3E%0ASELECT%20DISTINCT%20%3Feid%20%28str%28%3Fc%29%20as%20%3Fcu%29%20%3Fcl%20%28str%28%3Ft%29%20%20as%20%3Ftu%29%20%3Ftl%20%28str%28%3Fp%29%20as%20%3Fpu%29%20%3Fpl%20%28str%28%3Fa%29%20as%20%3Fau%29%20%3Fal%0AWHERE%20%7B%0A%7B%0AOPTIONAL%20%7B%0A%3Fc%20a%20ears2%3AToolCategory.%0A%3Ft%20a%20ears2%3ATool.%0A%3Fe%20ears2%3AhasProcess%20%3Fp.%0A%3Fe%20ears2%3AhasAction%20%3Fa.%20%0A%3Fe%20ears2%3AwithTool%20%3Ft.%20%0A%3Ft%20ears2%3AisMemberOf%20%3Fc.%0A%3Fe%20ears2%3AasConcept%20%3Fec.%0A%3Fec%20dc%3Aidentifier%20%3Feid.%0A%3Fc%20ears2%3AasConcept%20%3Fcc.%0A%3Fcc%20skos%3AprefLabel%20%3Fcl%20.%0A%3Ft%20ears2%3AasConcept%20%3Ftc.%0A%3Ftc%20skos%3AprefLabel%20%3Ftl%20.%0A%3Fp%20ears2%3AasConcept%20%3Fpc.%0A%3Fpc%20skos%3AprefLabel%20%3Fpl%20.%0A%3Fa%20ears2%3AasConcept%20%3Fac.%0A%3Fac%20skos%3AprefLabel%20%3Fal%20%20%7D%0A%20%7D%0A%0A%7D";
            var eventData = {
                identifier: null,
                eventDefinitionId: null,
                timeStamp: null,
                actor: {
                    firstName: null,
                    lastName: null,
                    organisation: null,
                    phoneNumber: null,
                    faxNumber: null,
                    email: null
                },
                subject: {
                    identifier: 'http://vocab.nerc.ac.uk/collection/C77/current/G71/',
                    transitiveIdentifier: null,
                    name: 'In-situ seafloor measurement/sampling'
                },
                tool: {
                    tool: {
                        identifier: 'http://vocab.nerc.ac.uk/collection/L22/current/TOOL0653/',
                        transitiveIdentifier: null,
                        name: 'Van Veen grab'
                    },
                    parentTool: null
                },
                toolCategory: {
                    identifier: 'http://vocab.nerc.ac.uk/collection/L05/current/50/',
                    transitiveIdentifier: null,
                    name: 'sediment grabs'
                },
                process: {
                    identifier: 'http://ontologies.ef-ears.eu/ears2/1#pro_1',
                    transitiveIdentifier: null,
                    name: 'Sampling'
                },
                action: {
                    identifier: 'http://ontologies.ef-ears.eu/ears2/1#act_2',
                    transitiveIdentifier: null,
                    name: 'End'
                },
                program: null,
                platform: 'SDN:C17::48UI'

            };

            function postLastEvent(recentEventId) {
                var startCondition11 = "(";
                var eid11 = "element.eid.value  == " + "'" + recentEventId.id + "'" + "  && ";
                var endCondition11 = ")";
                var condition11 = startCondition11.concat(eid11, endCondition11).replace(/&&([^'&&']*)$/, '' + '$1');
                $.getJSON("json/rdf.json",
                        function (data) {
                            $(data.results.bindings).each(function (index, element) {
                                if (eval(condition11)) {
                                    //             alert('recent  ' + element.eid.value + '===>' + element.cl.value + '-----' + element.tl.value + '-----' + element.pl.value + '-----' + element.al.value);

                                    var ts = new Date();
                                    // alert(ts.toISOString());
                                    //alert( JSON.parse(localStorage.getItem('ears_authentication')).firstName);
                                    eventData.eventDefinitionId = element.eid.value;
                                    eventData.timeStamp = ts.toISOString();
                                    eventData.actor.firstName = JSON.parse(localStorage.getItem('ears_authentication')).firstName; //
                                    eventData.actor.lastName = JSON.parse(localStorage.getItem('ears_authentication')).lastName; //
                                    eventData.actor.organisation = JSON.parse(localStorage.getItem('ears_authentication')).organisation; //

                                    eventData.toolCategory.identifier = element.cu.value;
                                    eventData.toolCategory.name = element.cl.value;
                                    eventData.tool.tool.identifier = element.tu.value;
                                    eventData.tool.tool.name = element.tl.value;
                                    eventData.process.identifier = element.pu.value;
                                    eventData.process.name = element.pl.value;
                                    eventData.action.identifier = element.au.value;
                                    eventData.action.name = element.al.value;
                                    // alert(JSON.parse(localStorage.getItem('ears_authentication')).program);
                                    //eventData.program='jjjjjjj';
                                    //  alert(JSON.parse(localStorage.getItem('ears_authentication')).platform);
                                    // eventData.program=JSON.parse(localStorage.getItem('ears_authentication')).program;
                                    //  eventData.platform=JSON.parse(localStorage.getItem('ears_authentication')).platform;
                                    $.ajax({
                                        type: "POST",
                                        contentType: "application/json; charset=utf-8",
                                        url: eventPostLocation,
                                        data: JSON.stringify(eventData),
                                        success: function (result) {
                                            $(recentEventId).fadeOut(
                                                    200, function () {
                                                        $(recentEventId).addClass("btn-success");
                                                    }).fadeIn(200);
                                            $(recentEventId).fadeOut(
                                                    200, function () {
                                                        $(recentEventId).removeClass("btn-success");
                                                    }).fadeIn(200);
                                            $("#collapseOne").addClass("show");
                                        },
                                        error: function (result) {
                                            $(recentEventId).fadeOut(
                                                    200, function () {
                                                        $(this).text('Send failed');
                                                        $(recentEventId).addClass("btn-warning");
                                                    }).fadeIn(200);
                                            $(recentEventId).fadeOut(
                                                    200, function () {
                                                        $(this).text('Send failed');
                                                        $(recentEventId).removeClass("btn-warning");
                                                    }).fadeIn(200);
                                        }
                                    });
                                }
                            }
                            )
                        }
                );
            }

            if (window.localStorage) {
                $(document).ready(function () {
                    if (JSON.parse(localStorage.getItem('ears_authentication')) == null) {
                        window.location.href = 'login.html';
                    } else {
                        $("#firstNameLabel").html(JSON.parse(localStorage.getItem('ears_authentication')).firstName);
                        $("#lastNameLabel").html(JSON.parse(localStorage.getItem('ears_authentication')).lastName);
                        $("#programLabel").html(JSON.parse(localStorage.getItem('ears_authentication')).program);
                    }
                    $('#id_collapse_in').css('visibility', 'hidden');
                    $('#id_collapse_out').css('visibility', 'visible');
                    $(".collapse").on('show.bs.collapse', function () {
                        $('#id_collapse_in').css('visibility', 'visible');
                        $('#id_collapse_out').css('visibility', 'hidden');
                    });
                    $(".collapse").on('hide.bs.collapse', function () {
                        $('#id_collapse_in').css('visibility', 'hidden');
                        $('#id_collapse_out').css('visibility', 'visible');
                    });
                    var queueFiFO = [];
                    var queueFiFO_sorting = new Array;
                    var sortFunction = function (a, b) {
                        return Date.parse(a.date) - Date.parse(b.date);
                    }

                    if (typeof localStorage != 'undefined' && JSON) {

                        for (let index = 0; index < 5; index++) {//si le même eid pas le mettre                        
                            var get_eventDefinitionId = JSON.parse(localStorage.getItem(('eventId').concat(index)));
                            if (get_eventDefinitionId === null) {
                                break;
                            } else {
                                //    alert(index);
                                //    alert('eventId'.concat(index) + '  ' + get_eventDefinitionId.eventDefinitionId + '  ' + get_eventDefinitionId.dateEventDefinitionId);
                                queueFiFO_sorting[index] = {date: get_eventDefinitionId.dateEventDefinitionId, indexation: index}; //2020-09-30T12:21:42.121Z
                                //  queueFiFO.push('eventId'.concat(index)); //order by date puis dans queue fifo
                            }
                        }

                        queueFiFO_sorting.sort(sortFunction);
                        queueFiFO_sorting.forEach(function (value, index) {
                            //  alert(index +'  '+  JSON.stringify(value.date)+ JSON.stringify(value.indexation) );
                            queueFiFO.push('eventId'.concat(JSON.stringify(value.indexation)));
                            //   alert('eventId'.concat(JSON.stringify(value.indexation)));

                        });
                    } else {
                        alert("Sorry, your browser does not support local storage.");
                    }
                    ;
                    //   alert(queueFiFO.length);
                    $('.cell_hover').hover(
                            function () {
                                $(this).addClass('border border-info');
                            },
                            function () {
                                $(this).removeClass('border border-info');
                            });
                    $('#id_eid').hide();
                    $.getScript("js/loadDropDownList.js");
                    //on change dropdown list then
                    $.getScript("js/onchangeTC01.js");
                    $.getScript("js/onchangeT01.js");
                    $.getScript("js/onchangeP01.js");
                    $.getScript("js/onchangeA01.js");
                    //  $.getScript("onchangeTCD.js");
                    //  $.getScript("onchangeTD.js");
                    //  $.getScript("onchangePD.js");
                    //  $.getScript("onchangeAD.js");

                    //if reset tc
                    $("#cell_tc_unlock").click(function () {
                        $.getScript("js/unlock_tc.js");
                    });
                    $("#cell_t_unlock").click(function () {
                        $.getScript("js/unlock_t01.js");
                        $('#idSelect_t').prop('disabled', false);
                        $('#idSelect_t').selectpicker('refresh');
                        $('#t_lock').css('visibility', 'hidden');
                        $('#t_unlock').css('visibility', 'visible');
                        $('#idSelect_p').prop('disabled', false);
                        $('#idSelect_p').selectpicker('refresh');
                        $('#p_lock').css('visibility', 'hidden');
                        $('#p_unlock').css('visibility', 'visible');
                        $('#idSelect_a').prop('disabled', false);
                        $('#idSelect_a').selectpicker('refresh');
                        $('#a_lock').css('visibility', 'hidden');
                        $('#a_unlock').css('visibility', 'visible');
                        $.getScript("js/hide_warning.js");
                        //$('#id_form_process').hide();
                        $('#id_eid').hide();
                    });
                    $("#cell_p_unlock").click(function () {
                        $.getScript("js/unlock_p01.js");
                        $('#idSelect_p').prop('disabled', false);
                        $('#idSelect_p').selectpicker('refresh');
                        $('#p_lock').css('visibility', 'hidden');
                        $('#p_unlock').css('visibility', 'visible');
                        $('#idSelect_a').prop('disabled', false);
                        $('#idSelect_a').selectpicker('refresh');
                        $('#a_lock').css('visibility', 'hidden');
                        $('#a_unlock').css('visibility', 'visible');
                        $.getScript("js/hide_warning.js"); //$('#id_form_process').hide();
                        $('#id_eid').hide();
                    });
                    $("#cell_a_unlock").click(function () {
                        $.getScript("js/unlock_a01.js");
                        $('#idSelect_a').prop('disabled', false);
                        $('#idSelect_a').selectpicker('refresh');
                        $('#a_lock').css('visibility', 'hidden');
                        $('#a_unlock').css('visibility', 'visible');
                        $.getScript("js/hide_warning.js"); //$('#id_form_process').hide();
                        $('#id_eid').hide();
                    });
                    $('.target').click(function (e) {
                        e.preventDefault();
                        $.getScript("js/hide_warning.js"); //    $('#id_form_process').hide();
                    });
                    $('form').submit(function (e) {
                        e.preventDefault();
                        eventSubmitDate = new Date(Date.now());
                        var text = "";
                        if (($("#idSelect_tc").val() == 1)
                                || ($("#idSelect_t").val() == 1)
                                || ($("#idSelect_p").val() == 1)
                                || ($("#idSelect_a").val() == 1)) {

                            $.getScript("js/show_warning.js");
                            //   $('#id_form_process').show();
                        } else {
                            $.getScript("js/hide_warning.js"); // $('#id_form_process').hide();

                            var condition = '';
                            var startCondition = "(";
                            if ($("#idSelect_tc").val() != 1) {
                                cu = "element.cu.value  == " + "'" + $("#idSelect_tc").val() + "'" + "  && ";
                            }
                            if ($("#idSelect_t").val() != 1) {
                                tu = "element.tu.value  == " + "'" + $("#idSelect_t").val() + "'" + "  && ";
                            }
                            if ($("#idSelect_p").val() != 1) {
                                pu = "element.pu.value  == " + "'" + $("#idSelect_p").val() + "'" + "  && ";
                            }
                            if ($("#idSelect_a").val() != 1) {
                                au = "element.au.value  == " + "'" + $("#idSelect_a").val() + "'" + "  && ";
                            }
                            var endCondition = ")";
                            //  console.log('concat' + startCondition.concat(cu, tu, pu, au, endCondition));

                            condition = startCondition.concat(cu, tu, pu, au, endCondition).replace(/&&([^'&&']*)$/, '' + '$1');
                            var resultJson = [];
                            $.getJSON("json/rdf.json",
                                    function (data) {
                                        $(data.results.bindings).each(function (index, element) {
                                            if (eval(condition)) { //(element.tu.value  == 'http://ontologies.ef-ears.eu/ears2/1#ves_1792'   )
                                                //            alert(element.eid.value + '===>' + element.cl.value + '-----' + element.tl.value + '-----' + element.pl.value + '-----' + element.al.value);
                                                //element.eid.value,eventSubmitDate.toISOString()
                                                // Méthode de stockage document.getElementById('stockage').onclick = function() 

                                                if (typeof localStorage != 'undefined' && JSON) {
                                                    var eventDefinitionId = {
                                                        eventDefinitionId: element.eid.value,
                                                        dateEventDefinitionId: eventSubmitDate.toISOString()
                                                    };
                                                    var monobjet_json = JSON.stringify(eventDefinitionId);
                                                    ///   alert('1'+monobjet_json);
                                                    var follow = 1;
                                                    //////////////////AA
                                                    //test if localStorage is not empty 
                                                    //   alert('quefifo'+queueFiFO.length);

                                                    if (queueFiFO.length == 0) {
                                                        // alert('2 is null');
                                                        localStorage.setItem('eventId0', monobjet_json);
                                                        // alert('eventId'.concat(eventSubmitDate.getTime()));
                                                        queueFiFO.push('eventId0');
                                                    } else {
                                                        //   alert('2  is not null on compare on doit enlever qqchoses alors '+queueFiFO.length);
                                                        for (let index = 0; index < queueFiFO.length; index++) {//si le même eid pas le mettre                        
                                                            var get_eventDefinitionId = JSON.parse(localStorage.getItem(('eventId'.concat(index))));
                                                            var str1 = get_eventDefinitionId.eventDefinitionId;
                                                            var str2 = element.eid.value;
                                                            if (str1.localeCompare(str2) == 0) {
                                                                //   alert('identique  ');
                                                                follow = 0;
                                                                //index);                                               
                                                                localStorage.removeItem('eventId'.concat(index));
                                                                localStorage.setItem('eventId'.concat(index), monobjet_json);
                                                                queueFiFO.splice(index, 1, 'eventId'.concat(index)); //05102020 replace with new 
                                                                //pas de push alors  queueFiFO.push('eventId'.concat(index));
                                                                break;
                                                            }
                                                        }
                                                        if (follow == 1) {
                                                            //    alert('pas identique on enregistre si pas plus de 5 sinon delete le premier et on sort de la boucle' + queueFiFO.length + '  ' + follow);
                                                            if (queueFiFO.length < 5) {
                                                                //alert('on rajoute car <5 ');
                                                                localStorage.setItem('eventId'.concat(queueFiFO.length), monobjet_json);
                                                                // alert('eventId'.concat(eventSubmitDate.getTime()));
                                                                queueFiFO.splice(queueFiFO.length, 1, 'eventId'.concat(queueFiFO.length)); //05102020 replace with new 
                                                                //05102020  queueFiFO.push('eventId'.concat(queueFiFO.length));
                                                            } else {
                                                                //    alert('on vire le plus vieux et on rajoute ');
                                                                //ici le shift ne marche pas car  et ps c est le 0
                                                                var queueFiFO_sorting_order = new Array;
                                                                for (let index = 0; index < 5; index++) {//si le même eid pas le mettre                        
                                                                    var get_eventDefinitionId = JSON.parse(localStorage.getItem(('eventId').concat(index)));
                                                                    if (get_eventDefinitionId === null) {
                                                                        break;
                                                                    } else {
                                                                        queueFiFO_sorting_order[index] = {date: get_eventDefinitionId.dateEventDefinitionId, indexation: index}; //2020-09-30T12:21:42.121Z
                                                                        //    queueFiFO.push('eventId'.concat(index));
                                                                    }
                                                                }
                                                                queueFiFO_sorting_order.sort(sortFunction);
                                                                //   alert( queueFiFO_sorting_order[0].indexation);
                                                                //  alert('on vire le ' + queueFiFO_sorting_order[0].indexation);
                                                                //   alert('on vire le ' + i);
                                                                localStorage.removeItem('eventId' + queueFiFO_sorting_order[0].indexation);
                                                                localStorage.setItem('eventId' + queueFiFO_sorting_order[0].indexation, monobjet_json);
                                                                queueFiFO.splice(0, 1, 'eventId' + queueFiFO_sorting_order[0].indexation); //05102020 replace with new 
                                                                /*    var i = queueFiFO.shift(); // queue is now [First entry to delete localStorage.removeItem("couleur");]
                                                                 localStorage.removeItem('eventId'.concat(i.charAt(7)));
                                                                 localStorage.setItem('eventId'.concat(i.charAt(7)), monobjet_json);
                                                                 queueFiFO.splice(i.charAt(7), 1,'eventId'.concat(queueFiFO.length)); 
                                                                 */

                                                                //05102020 replace with new 
                                                                //05102020    queueFiFO.push('eventId'.concat(i.charAt(7)));
                                                                //alert(i + '  ' + queueFiFO.length);              // displays 2
                                                            }
                                                        }
                                                    }
                                                    //   alert("Mémorisation effectuée");
                                                } else {
                                                    alert("local storage");
                                                }

                                                // Méthode de lecture document.getElementById('lecture').onclick = function()
                                                /*
                                                 if (typeof localStorage != 'undefined' && JSON) {
                                                 var  x='';
                                                 var get_eventDefinitionId = JSON.parse(localStorage.getItem(x.search('eventId')));
                                                 alert(get_eventDefinitionId.eventDefinitionId + '  ' + get_eventDefinitionId.dateEventDefinitionId);
                                                 
                                                 }
                                                 else {
                                                 alert("localStorage n'est pas supporté");
                                                 };
                                                 
                                                 */



                                                /*    
                                                 for (let index = 0; index < 5; index++) {//si le même eid pas le mettre                        
                                                 
                                                 }
                                                 for (let index = 0; index < queueFiFO.length; index++) {
                                                 alert( queueFiFO[index].value);
                                                 
                                                 }*/



                                                ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

                                                /*       $('#id_eid').html("<div class='alert alert-error'>" + element.eid.value + '</br>' + eventSubmitDate.toISOString() + "</div>").fadeTo(500, 500).slideUp(500, function () {
                                                 $("#success-alert").alert('close');
                                                 
                                                 });*/
                                                //POST EVENT TO

                                                //alert(element.eid.value + '===>' + element.cl.value + '-----' + element.tl.value + '-----' + element.pl.value + '-----' + element.al.value);

                                                var UUID = uuidv4();
                                                eventData.identifier = UUID;
                                                //  alert(UUID);
                                                eventData.eventDefinitionId = element.eid.value;
                                                eventData.timeStamp = eventSubmitDate.toISOString();
                                                eventData.actor.firstName = JSON.parse(localStorage.getItem('ears_authentication')).firstName; //
                                                eventData.actor.lastName = JSON.parse(localStorage.getItem('ears_authentication')).lastName; //
                                                eventData.actor.organisation = JSON.parse(localStorage.getItem('ears_authentication')).organisation; //
                                                eventData.toolCategory.identifier = element.cu.value;
                                                eventData.toolCategory.name = element.cl.value;
                                                eventData.tool.tool.identifier = element.tu.value;
                                                eventData.tool.tool.name = element.tl.value;
                                                eventData.process.identifier = element.pu.value;
                                                eventData.process.name = element.pl.value;
                                                eventData.action.identifier = element.au.value;
                                                eventData.action.name = element.al.value;
                                                // eventData.platform=JSON.parse(localStorage.getItem('ears_authentication')).platform;



                                                $.ajax({
                                                    type: "POST",
                                                    contentType: "application/json; charset=utf-8",
                                                    url: eventPostLocation,
                                                    data: JSON.stringify(eventData),
                                                    success: function (result) {
                                                        //   alert('sent '+UUID+ ' to server');
                                                        $('.succesSended').css('visibility', 'visible').fadeTo(1000, 500).slideUp(500, function () {

                                                        });
                                                    },
                                                    error: function (result) {
                                                        $('.succesSended').css('visibility', 'visible').fadeTo(1000, 500).slideUp(500, function () {

                                                        });
                                                        $('.succesSended').attr("fill", "red");
                                                    }
                                                });
                                                //END POST EVENT TO


                                                //mise à jour du collapse

                                                //clear data before 
                                                $("#recentEvents").empty();
                                                var queueFiFO_sorting_order = new Array;
                                                for (let index = 0; index < 5; index++) {//si le même eid pas le mettre                        
                                                    var get_eventDefinitionId = JSON.parse(localStorage.getItem(('eventId').concat(index)));
                                                    if (get_eventDefinitionId === null) {
                                                        break;
                                                    } else {
                                                        queueFiFO_sorting_order[index] = {date: get_eventDefinitionId.dateEventDefinitionId, id: get_eventDefinitionId.eventDefinitionId}; //2020-09-30T12:21:42.121Z

                                                        //    queueFiFO.push('eventId'.concat(index));
                                                    }
                                                }
                                                queueFiFO_sorting_order.sort(sortFunction);
                                                queueFiFO_sorting_order.forEach(function (value, index) {
                                                    /////////////////07102020
                                                    var startCondition1 = "(";
                                                    var eid1 = "element.eid.value  == " + "'" + value.id + "'" + "  && ";
                                                    var endCondition1 = ")";
                                                    var condition1 = startCondition1.concat(eid1, endCondition1).replace(/&&([^'&&']*)$/, '' + '$1');
                                                    // alert(index+'  '+condition);
                                                    $.getJSON("json/rdf.json",
                                                            function (data) {
                                                                $(data.results.bindings).each(function (index, element) {
                                                                    if (eval(condition1)) {
                                                                        //(element.tu.value  == 'http://ontologies.ef-ears.eu/ears2/1#ves_1792'   )
                                                                        //  alert('recent  ' + element.eid.value + '===>' + element.cl.value + '-----' + element.tl.value + '-----' + element.pl.value + '-----' + element.al.value);
                                                                        //   <tbody class="table-hover">
                                                                        //</tbody>
                                                                        // $("#recentEvents").append("<tbody class='table-hover'><tr><td>" //+ JSON.stringify(value.date) + "</td><td>" 
                                                                        //                                                                                                                 //  + value.id + "</td><td>" +
                                                                        //                                                                                                                 //  + element.eid.value  + "</td><td>" +
                                                                        //                                                                                                                 + element.cl.value + "</td><td>" +
                                                                        //                                                                                                                 element.tl.value + "</td><td>" +
                                                                        //                                                                                                                 element.pl.value + "</td><td>" +

                                                                        //                                                                                                                 element.al.value + "</td><td>" +
                                                                        // "<button id=" + element.eid.value + " type='button' onclick='postLastEvent(this);' class='btn btn-default'>Submit </button>"

                                                                        //                                                                                                                 + "</td></tr></tbody>"



                                                                        //                                                                                                          );
                                                                        $("#recentEvents").append("<tbody class='table-hover'><tr><td width=25%>" +
                                                                                "<button id=" + element.eid.value + " type='button' onclick='postLastEvent(this);' class='btn btn-default btn-block text-left inline-block'>"
                                                                                + "<table><tr><td width=25%>" + element.cl.value + "</td><td width=25%>" + element.tl.value + "</td><td width=25%>" + element.pl.value + "</td><td width=25%>" + element.al.value + "</td></tr></table>" +
                                                                                "</button>" + "</td></tr></tbody>");
                                                                        // $("#recentEvents").append("<tbody class='table-hover'><tr><td>" +
                                                                        // "<button id=" + element.eid.value + " type='button' onclick='postLastEvent(this);' class='btn btn-default btn-block text-left inline-block'>"+ element.cl.value +'|'+ element.tl.value +'|'+ element.pl.value +'|'+  element.al.value +  "</button>"
                                                                        //  + "</td></tr></tbody>"
                                                                        //  );
                                                                    }

                                                                }
                                                                )
                                                            }
                                                    );
                                                    /////////////////07102020

                                                    //   alert(index +'  '+  JSON.stringify(value.date)+ JSON.stringify(value.id) );

                                                    // queueFiFO.push('eventId'.concat(JSON.stringify(value.indexation)));
                                                });
                                                //end mise à jour collapse                            


                                                // $.getScript("hide_warning.js");//   $('#id_form_process').hide();
                                                //a remettre en ordre            $('#id_eid').show();


                                                /////A
                                                /*if (typeof localStorage != 'undefined' && JSON) {
                                                 for (let index = 0; index < 5; index++) {//si le même eid pas le mettre                        
                                                 var get_eventDefinitionId = JSON.parse(localStorage.getItem(('eventId').concat(index)));
                                                 //        alert(get_eventDefinitionId.eventDefinitionId + '  ' + get_eventDefinitionId.dateEventDefinitionId);
                                                 if (get_eventDefinitionId  !== null) {
                                                 $("#recentEvents").after("<tr><td>" + get_eventDefinitionId.eventDefinitionId + "</td><td>" + get_eventDefinitionId.dateEventDefinitionId+ "</td></tr>");
                                                 
                                                 
                                                 }
                                                 }                  
                                                 
                                                 
                                                 
                                                 }
                                                 else {
                                                 alert("localStorage n'est pas supporté");
                                                 };
                                                 
                                                 */

                                                /////A


                                            }
                                        });
                                    }
                            );
                        }
                        //$( ".inner" ).append( "<div class='alert alert-danger' role='alert'>"+text+"</div>" );
                    });
                    //mise à jour du collapse
                    var queueFiFO_sorting_order = new Array;
                    for (let index = 0; index < 5; index++) {//si le même eid pas le mettre                        
                        var get_eventDefinitionId = JSON.parse(localStorage.getItem(('eventId').concat(index)));
                        if (get_eventDefinitionId === null) {
                            break;
                        } else {
                            queueFiFO_sorting_order[index] = {date: get_eventDefinitionId.dateEventDefinitionId, id: get_eventDefinitionId.eventDefinitionId}; //2020-09-30T12:21:42.121Z
                            //    queueFiFO.push('eventId'.concat(index));
                        }
                    }
                    queueFiFO_sorting_order.sort(sortFunction);
                    queueFiFO_sorting_order.forEach(function (value, index) {
                        var startCondition1 = "(";
                        var eid1 = "element.eid.value  == " + "'" + value.id + "'" + "  && ";
                        var endCondition1 = ")";
                        var condition1 = startCondition1.concat(eid1, endCondition1).replace(/&&([^'&&']*)$/, '' + '$1');
                        // alert(index+'  '+condition);
                        $.getJSON("json/rdf.json",
                                function (data) {
                                    $(data.results.bindings).each(function (index, element) {
                                        if (eval(condition1)) {
                                            //(element.tu.value  == 'http://ontologies.ef-ears.eu/ears2/1#ves_1792'   )
                                            //  alert('recent  ' + element.eid.value + '===>' + element.cl.value + '-----' + element.tl.value + '-----' + element.pl.value + '-----' + element.al.value);
                                            //+ JSON.stringify(value.date) + "</td><td>" 
                                            //  + value.id + "</td><td>" +
                                            // element.eid.value  + "</td><td>"

                                            // $("#recentEvents").append("<tr><td>" 
                                            //             +  element.cl.value    + "</td><td>" +
                                            //                      element.tl.value      + "</td><td>" +
                                            //                             element.pl.value   + "</td><td>"+
                                            //                             element.al.value   + "</td><td>"+
                                            //  "<button id="+element.eid.value+" type='button' onclick='postLastEvent(this);' class='btn btn-default'>Submit </button>"+ "</td></tr>"

                                            //                             );
                                            $("#recentEvents").append("<tbody class='table-hover'><tr><td width=25%>" +
                                                    "<button id=" + element.eid.value + " type='button' onclick='postLastEvent(this);' class='btn btn-default btn-block text-left inline-block' style='width: 100%; font: inherit;padding: 0;width: 100%;border: 0;'>"
                                                    + "<table><tr><td width=25%>" + element.cl.value + "</td><td width=25%>" + element.tl.value + "</td width=25%><td align=center>" + element.pl.value + "</td><td width=25%>" + element.al.value + "</td></tr></table>" +
                                                    "</button>" + "</td></tr></tbody>");
                                        }
                                    }
                                    )
                                }
                        );
                        //   alert(index +'  '+  JSON.stringify(value.date)+ JSON.stringify(value.id) );
                        /* 07102020   $("#recentEvents").append("<tr><td>" + JSON.stringify(value.date) + "</td><td>" + value.id + "</td><td>" +
                         "<button type='button' onclick='productDelete(this);' class='btn btn-default'>Submit </button>"
                         + "</td></tr>");
                         */
                        // queueFiFO.push('eventId'.concat(JSON.stringify(value.indexation)));
                    });
                    //end mise à jour collapse                            
                });
            } else {
                alert("Sorry, your browser does not support local storage.");
            }
        </script>
    </body>
</html>