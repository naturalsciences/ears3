<!DOCTYPE html>
<html lang="en">
    <head th:replace="fragments/f :: head"></head>
    <body>
        <nav th:replace="fragments/f :: header"></nav>
        <div class="container">
            <div class="row">
                <div class="col-sm-12">
                    <!--    <div class='alert alert-danger' role='alert' id="id_form_process">All list must be selected.</div>-->
                    <div class="alert alert-info" role="alert" id="id_eid"></div>
                </div>
            </div>

            <!--Recent Event by Accordeon module-->
            <div class="accordion" id="id_accordion">
                <div class="card">
                    <div class="card-header" id="headingOne">
                        <h2 class="mb-0">
                            <button id="id_collapse_button" class="btn btn-link btn-block text-left" type="button"
                                    data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" 
                                    aria-controls="collapseOne">
                                Common scenarios
                                <svg id="id_collapse_in" width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-down pull-right" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                                </svg>

                                <svg id="id_collapse_out" width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-up  pull-right" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"/>
                                </svg>
                            </button>
                        </h2>
                    </div>

                    <div id="collapseOne" class="collapse show " aria-labelledby="headingOne" data-parent="#id_accordion">
                        <form role="form" class="class_form">
                            <table id="recentEvents" >                     
                                <!--table-bordered-->
                                <tr style="min-height: 50px;">
                                    <td id="cell0"></td>
                                    <td id="cell1"></td>
                                    <td id="cell2"></td>
                                </tr>
                                <tr style="min-height: 50px;"> 
                                    <td id="cell3"></td>
                                    <td id="cell4"></td>
                                    <td id="cell5"></td>
                                </tr>
                                <tr style="height: 50px;">                                    
                                    <td id="cell6"></td>
                                    <td id="cell7"></td>
                                    <td id="cell8"></td>
                                </tr>
                            </table>
                        </form>
                    </div>
                </div>
            </div>

            <form role="form" class="class_form" method="POST">
                <table class="table" id="laTable">
                    <!--table-bordered-->
                    <tbody>
                        <tr id="tr_tc">
                            <td class="col-3 col-sm-1">Category</td>
                            <td class="col-3 col-sm-9"> <select name="clcu" id="idSelect_tc"
                                                                class="selectpicker target  form-control"
                                                                data-live-search="true" data-with="auto">
                                </select>
                            </td>
                            <td class="col-6 col-sm-2 cell_hover" id="cell_tc_unlock"> <svg id="tc_unlock"
                                                                                            width="1em" height="1em" viewBox="0 0 16 16"
                                                                                            class="bi bi-unlock" fill="green"
                                                                                            xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M9.655 8H2.333c-.264 0-.398.068-.471.121a.73.73 0 0 0-.224.296 1.626 1.626 0 0 0-.138.59V14c0 .342.076.531.14.635.064.106.151.18.256.237a1.122 1.122 0 0 0 .436.127l.013.001h7.322c.264 0 .398-.068.471-.121a.73.73 0 0 0 .224-.296 1.627 1.627 0 0 0 .138-.59V9c0-.342-.076-.531-.14-.635a.658.658 0 0 0-.255-.237A1.122 1.122 0 0 0 9.655 8zm.012-1H2.333C.5 7 .5 9 .5 9v5c0 2 1.833 2 1.833 2h7.334c1.833 0 1.833-2 1.833-2V9c0-2-1.833-2-1.833-2zM8.5 4a3.5 3.5 0 1 1 7 0v3h-1V4a2.5 2.5 0 0 0-5 0v3h-1V4z" />
                                </svg>

                                <svg id="tc_lock" width="1em" height="1em" viewBox="0 0 16 16"
                                     class="bi bi-lock" fill="red"
                                     xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M11.5 8h-7a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1zm-7-1a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-7zm0-3a3.5 3.5 0 1 1 7 0v3h-1V4a2.5 2.5 0 0 0-5 0v3h-1V4z" />
                                </svg>

                                <svg class="sendSuccessOrFailure bi bi-check-circle-fill" width="1em" height="1em" viewBox="0 0 16 16"
                                     fill="green"
                                     xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                                </svg>
                            </td>
                        </tr>
                        <tr id="tr_t">
                            <td class="col-3 col-sm-1">Tool</td>
                            <td class="col-3 col-sm-9"> <select name="tltu" id="idSelect_t"
                                                                class="selectpicker target  form-control"
                                                                data-live-search="true">

                                </select></td>
                            <td class="col-6 col-sm-2 cell_hover" id="cell_t_unlock"> <svg id="t_unlock"
                                                                                           width="1em" height="1em" viewBox="0 0 16 16"
                                                                                           class="bi bi-unlock" fill="green"
                                                                                           xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M9.655 8H2.333c-.264 0-.398.068-.471.121a.73.73 0 0 0-.224.296 1.626 1.626 0 0 0-.138.59V14c0 .342.076.531.14.635.064.106.151.18.256.237a1.122 1.122 0 0 0 .436.127l.013.001h7.322c.264 0 .398-.068.471-.121a.73.73 0 0 0 .224-.296 1.627 1.627 0 0 0 .138-.59V9c0-.342-.076-.531-.14-.635a.658.658 0 0 0-.255-.237A1.122 1.122 0 0 0 9.655 8zm.012-1H2.333C.5 7 .5 9 .5 9v5c0 2 1.833 2 1.833 2h7.334c1.833 0 1.833-2 1.833-2V9c0-2-1.833-2-1.833-2zM8.5 4a3.5 3.5 0 1 1 7 0v3h-1V4a2.5 2.5 0 0 0-5 0v3h-1V4z" />
                                </svg>

                                <svg id="t_lock" width="1em" height="1em" viewBox="0 0 16 16"
                                     class="bi bi-lock" fill="red"
                                     xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M11.5 8h-7a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1zm-7-1a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-7zm0-3a3.5 3.5 0 1 1 7 0v3h-1V4a2.5 2.5 0 0 0-5 0v3h-1V4z" />
                                </svg>
                                <svg class="sendSuccessOrFailure bi bi-check-circle-fill" width="1em" height="1em" viewBox="0 0 16 16"
                                     fill="green"
                                     xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                                </svg>

                            </td>
                        </tr>
                        <tr id="tr_p">
                            <td class="col-3 col-sm-1">Process</td>
                            <td class="col-3 col-sm-9"><select name="plpu" id="idSelect_p"
                                                               class="selectpicker target  form-control"
                                                               data-live-search="true">

                                </select></td>
                            <td class="col-6 col-sm-2 cell_hover" id="cell_p_unlock"> <svg id="p_unlock"
                                                                                           width="1em" height="1em" viewBox="0 0 16 16"
                                                                                           class="bi bi-unlock" fill="green"
                                                                                           xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M9.655 8H2.333c-.264 0-.398.068-.471.121a.73.73 0 0 0-.224.296 1.626 1.626 0 0 0-.138.59V14c0 .342.076.531.14.635.064.106.151.18.256.237a1.122 1.122 0 0 0 .436.127l.013.001h7.322c.264 0 .398-.068.471-.121a.73.73 0 0 0 .224-.296 1.627 1.627 0 0 0 .138-.59V9c0-.342-.076-.531-.14-.635a.658.658 0 0 0-.255-.237A1.122 1.122 0 0 0 9.655 8zm.012-1H2.333C.5 7 .5 9 .5 9v5c0 2 1.833 2 1.833 2h7.334c1.833 0 1.833-2 1.833-2V9c0-2-1.833-2-1.833-2zM8.5 4a3.5 3.5 0 1 1 7 0v3h-1V4a2.5 2.5 0 0 0-5 0v3h-1V4z" />
                                </svg>

                                <svg id="p_lock" width="1em" height="1em" viewBox="0 0 16 16"
                                     class="bi bi-lock" fill="red"
                                     xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M11.5 8h-7a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1zm-7-1a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-7zm0-3a3.5 3.5 0 1 1 7 0v3h-1V4a2.5 2.5 0 0 0-5 0v3h-1V4z" />
                                </svg>
                                <svg class="sendSuccessOrFailure bi bi-check-circle-fill" width="1em" height="1em" viewBox="0 0 16 16"
                                     fill="green"
                                     xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                                </svg>
                            </td>
                        </tr>
                        <tr id="tr_a">
                            <td class="col-3 col-sm-1">Action</td>
                            <td class="col-3 col-sm-9"><select name="alau" id="idSelect_a"
                                                               class="selectpicker target  form-control"
                                                               data-live-search="true">

                                </select></td>
                            <td class="col-6 col-sm-2 cell_hover" id="cell_a_unlock">
                                <svg id="a_unlock" width="1em" height="1em" viewBox="0 0 16 16"
                                     class="bi bi-unlock" fill="green"
                                     xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M9.655 8H2.333c-.264 0-.398.068-.471.121a.73.73 0 0 0-.224.296 1.626 1.626 0 0 0-.138.59V14c0 .342.076.531.14.635.064.106.151.18.256.237a1.122 1.122 0 0 0 .436.127l.013.001h7.322c.264 0 .398-.068.471-.121a.73.73 0 0 0 .224-.296 1.627 1.627 0 0 0 .138-.59V9c0-.342-.076-.531-.14-.635a.658.658 0 0 0-.255-.237A1.122 1.122 0 0 0 9.655 8zm.012-1H2.333C.5 7 .5 9 .5 9v5c0 2 1.833 2 1.833 2h7.334c1.833 0 1.833-2 1.833-2V9c0-2-1.833-2-1.833-2zM8.5 4a3.5 3.5 0 1 1 7 0v3h-1V4a2.5 2.5 0 0 0-5 0v3h-1V4z" />
                                </svg>

                                <svg id="a_lock" width="1em" height="1em" viewBox="0 0 16 16"
                                     class="bi bi-lock" fill="red"
                                     xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M11.5 8h-7a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1zm-7-1a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-7zm0-3a3.5 3.5 0 1 1 7 0v3h-1V4a2.5 2.5 0 0 0-5 0v3h-1V4z" />
                                </svg>

                                <svg class="sendSuccessOrFailure bi bi-check-circle-fill" width="1em" height="1em" viewBox="0 0 16 16"
                                     fill="green"
                                     xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd"
                                      d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                                </svg>
                            </td>
                        </tr>

                    </tbody>
                </table>
                <div class="row">
                    <div class="col-sm-12">
                        <button id="idSubmit" type="submit"
                                class="btn btn-primary btn-lg btn-block">Submit</button>
                        <!--if alles = 1 => pas correct -->


                        <!--  <div class="col-md-4">
                               <div class="btn-group w-100 p-3 btn-group-lg h-50">
                                      <button id="idPost" type="submit" class="btn btn-primary">Post</button>
                               //if alles = 1 => pas correct                                          </div>
                        
                        </div>-->
                    </div>
                </div>
            </form>

            <div id="div1" style="width:80px;height:80px;display:none;background-color:red;"></div><br>
            <div id="success-alert"></div>
            <!--accordeon-->
        </div>
        <script>
            // https://developer.mozilla.org/fr/docs/Web/API/Web_Storage_API
            var then = new Date();
            then.setDate(then.getDate() - 30);
            const eventPostLocation = "../event";
            const jsonRdfLocation = "../ontology/vessel/sparql?q=PREFIX%20owl%3A%20%3Chttp%3A%2F%2Fwww.w3.org%2F2002%2F07%2Fowl%23%3E%0APREFIX%20dc%3A%20%3Chttp%3A%2F%2Fpurl.org%2Fdc%2Felements%2F1.1%2F%3E%0APREFIX%20skos%3A%3Chttp%3A%2F%2Fwww.w3.org%2F2004%2F02%2Fskos%2Fcore%23%3E%0APREFIX%20ears2%3A%3Chttp%3A%2F%2Fontologies.ef-ears.eu%2Fears2%2F1%23%3E%0APREFIX%20xsd%3A%3Chttp%3A%2F%2Fwww.w3.org%2F2001%2FXMLSchema%23%3E%0ASELECT%20DISTINCT%20%3Feid%20%28str%28%3Fc%29%20as%20%3Fcu%29%20%28str%28%3Fcc%29%20as%20%3Fctu%29%20%3Fcl%20%28str%28%3Ft%29%20%20as%20%3Ftu%29%20%28str%28%3Ftc%29%20as%20%3Fttu%29%20%3Ftl%20%28str%28%3Fp%29%20as%20%3Fpu%29%20%3Fpl%20%28str%28%3Fa%29%20as%20%3Fau%29%20%3Fal%0AWHERE%20%7B%0A%7B%0AOPTIONAL%20%7B%0A%3Fc%20a%20ears2%3AToolCategory.%0A%3Ft%20a%20ears2%3ATool.%0A%3Fe%20ears2%3AhasProcess%20%3Fp.%0A%3Fe%20ears2%3AhasAction%20%3Fa.%20%0A%3Fe%20ears2%3AwithTool%20%3Ft.%20%0A%3Ft%20ears2%3AisMemberOf%20%3Fc.%0A%3Fe%20ears2%3AasConcept%20%3Fec.%0A%3Fec%20dc%3Aidentifier%20%3Feid.%0A%3Fc%20ears2%3AasConcept%20%3Fcc.%0A%3Fcc%20skos%3AprefLabel%20%3Fcl%20.%0A%3Ft%20ears2%3AasConcept%20%3Ftc.%0A%3Ftc%20skos%3AprefLabel%20%3Ftl%20.%0A%3Fp%20ears2%3AasConcept%20%3Fpc.%0A%3Fpc%20skos%3AprefLabel%20%3Fpl%20.%0A%3Fa%20ears2%3AasConcept%20%3Fac.%0A%3Fac%20skos%3AprefLabel%20%3Fal%20%20%7D%0A%20%7D%0A%0A%7D%0AORDER%20BY%20%3Fpl%20%3Fal";
            class EarsEvent {
            constructor(sparqlResultElement) {
            //var ts = new Date();
            //event.timeStamp = ts.toISOString();
            //for brand new in-the-moment events no timestamp should be provided.
            this.eventDefinitionId = sparqlResultElement.eid.value;
            if (localStorage.actor !== null) {
            let actor = JSON.parse(localStorage.actor);
            this.actor = new Object();
            this.actor.firstName = actor.firstName;
            this.actor.lastName = actor.lastName;
            this.actor.email = actor.email;
            this.actor.organisation = actor.organisation;
            }
            this.toolCategory = new Object();
            this.toolCategory.identifier = sparqlResultElement.cu.value;
            this.toolCategory.name = sparqlResultElement.cl.value;
            this.tool = new Object();
            this.tool.tool = new Object();
            this.tool.tool.identifier = sparqlResultElement.tu.value;
            this.tool.tool.name = sparqlResultElement.tl.value;
            this.process = new Object();
            this.process.identifier = sparqlResultElement.pu.value;
            this.process.name = sparqlResultElement.pl.value;
            this.action = new Object();
            this.action.identifier = sparqlResultElement.au.value;
            this.action.name = sparqlResultElement.al.value;
            this.subject = new Object();
            this.subject.identifier = 'http://vocab.nerc.ac.uk/collection/C77/current/M06/';
            this.subject.name = 'Routine standard measurements';
            this.program = null;
            }
            }

            //just to give an idea on the structure
            const eventData = {
            identifier: null,
                    eventDefinitionId: null,
                    timeStamp: null,
                    actor: {
                    firstName: null,
                            lastName: null,
                            organisation: null,
                            phoneNumber: null,
                            faxNumber: null,
                            email: null
                    },
                    subject: {
                    identifier: 'http://vocab.nerc.ac.uk/collection/C77/current/M06/',
                            transitiveIdentifier: null,
                            name: 'Routine standard measurements'
                    },
                    tool: {
                    tool: {
                    identifier: 'http://vocab.nerc.ac.uk/collection/L22/current/TOOL0653/',
                            transitiveIdentifier: null,
                            name: 'Van Veen grab'
                    },
                            parentTool: null
                    },
                    toolCategory: {
                    identifier: 'http://vocab.nerc.ac.uk/collection/L05/current/50/',
                            transitiveIdentifier: null,
                            name: 'sediment grabs'
                    },
                    process: {
                    identifier: 'http://ontologies.ef-ears.eu/ears2/1#pro_1',
                            transitiveIdentifier: null,
                            name: 'Sampling'
                    },
                    action: {
                    identifier: 'http://ontologies.ef-ears.eu/ears2/1#act_2',
                            transitiveIdentifier: null,
                            name: 'End'
                    },
                    program: null,
                    platform: null
            };
            function postEventInner(event, successFunction, errorFunction) {
            let programFieldVal = $("#programField").val() === "" ? null : $("#programField").val();
            if (programFieldVal === null) {
            $('#programField').selectpicker('setStyle', 'btn-warning');
            } else {
            $('#programField').selectpicker('setStyle', 'btn-warning', 'remove');
            $('#programField').selectpicker('setStyle', 'btn-light', 'add');
            }

            event.program = programFieldVal;
            $.ajax({
            type: "POST",
                    dataType: "json",
                    contentType: "application/json;charset=utf-8",
                    url: eventPostLocation,
                    data: JSON.stringify(event),
                    success: function (result) {
                    console.log("Success: Event created with id:" + result.id + ", identifier:" + result.identifier + " and timeStamp:" + result.timeStamp);
                    successFunction();
                    },
                    error: function (result) {
                    console.log("Failure: " + result.status + ": " + result.responseText);
                    console.log(event);
                    errorFunction();
                    }
            });
            }

            function postEvent(recentEventButton) {
            recentEventId = recentEventId = recentEventButton.id;
            postEventByEventDefinition(recentEventId, function () {
            $(recentEventButton).removeClass("btn-warning").addClass("btn-success");
            setTimeout(function () {
            $(recentEventButton).removeClass("btn-success");
            }, 10000)
                    $("#collapseOne").addClass("show");
            }, function () {
            $(recentEventButton).removeClass("btn-success").addClass("btn-warning");
            });
            }

            function postEventByEventDefinition(eventDefinitionId, successFunction, errorFunction) {
            var startCondition11 = "(";
            var eid11 = "element.eid.value  == " + "'" + eventDefinitionId + "'" + "  && ";
            var endCondition11 = ")";
            var condition11 = startCondition11.concat(eid11, endCondition11).replace(/&&([^'&&']*)$/, '' + '$1');
            $.getJSON(jsonRdfLocation,
                    function (data) {
                    $(data.results.bindings).each(function (index, element) {
                    if (eval(condition11)) {
                    event = new EarsEvent(element);
                    postEventInner(event, successFunction, errorFunction);
                    }
                    }
                    )
                    }
            );
            }

            /*function postEventByUrls(toolcategoryUrl, toolUrl, processUrl, actionUrl) {
             var startCondition11 = "(";
             var eid11 = "element.eid.value  == " + "'" + recentEventId.id + "'" + "  && ";
             var endCondition11 = ")";
             var condition11 = startCondition11.concat(eid11, endCondition11).replace(/&&([^'&&']*)$/, '' + '$1');
             $.getJSON(jsonRdfLocation,
             function (data) {
             $(data.results.bindings).each(function (index, element) {
             if (eval(condition11)) {
             postEvent(element)
             }
             }
             )
             }
             );
             }*/

            function populateScenario(eventDefinitionId) {
            var startCondition1 = "(";
            var eid1 = "element.eid.value  == " + "'" + eventDefinitionId + "'" + "  && ";
            var endCondition1 = ")";
            var condition1 = startCondition1.concat(eid1, endCondition1).replace(/&&([^'&&']*)$/, '' + '$1');
            $.getJSON(jsonRdfLocation,
                    function (data) {
                    $(data.results.bindings).each(function (index, element) {
                    if (eval(condition1)) {
                    $("#recentEvents td#cell" + $('#recentEvents button').length).append("<button id=" + element.eid.value + " type='button' onclick='postEvent(this);' class='btn btn-default text-left'>"
                            + "<p>" + element.cl.value + "</p><p><strong>" + element.tl.value + "</strong></p><p>" + element.pl.value + "<br>" + element.al.value + "</p></button>");
                    }
                    })
                    }
            );
            }

            function isJSON(str) {
            try {
            return (JSON.parse(str) && !!str);
            } catch (e) {
            return false;
            }
            }

            function localStorageEventDefsToMap() {
            eventDefs = localStorage.eventDefinitions;
            if (isJSON(eventDefs)) {
            let map = new Map(JSON.parse(eventDefs));
            return map;
            }
            return null;
            }

            if (window.localStorage && typeof window.localStorage !== 'undefined') {
            $(document).ready(function () {
            if (localStorage.actor == null) {
            window.location.href = './settings';
            console.log("redirected back to settings");
            } else {
            var me = JSON.parse(localStorage.actor);
            $("#settings-link").html(me.firstName + " " + me.lastName);
            }
            $('#id_collapse_in').css('visibility', 'hidden');
            $('#id_collapse_out').css('visibility', 'visible');
            $(".collapse").on('show.bs.collapse', function () {
            $('#id_collapse_in').css('visibility', 'visible');
            $('#id_collapse_out').css('visibility', 'hidden');
            });
            $(".collapse").on('hide.bs.collapse', function () {
            $('#id_collapse_in').css('visibility', 'hidden');
            $('#id_collapse_out').css('visibility', 'visible');
            });
            $('.cell_hover').hover(
                    function () {
                    $(this).addClass('border border-info');
                    },
                    function () {
                    $(this).removeClass('border border-info');
                    });
            $('#id_eid').hide();
            $.getScript("js/loadDropDownList.js", function () {
            loadDropdownLists(jsonRdfLocation);
            });
            //on change dropdown list
            $.getScript("js/onchangeTC01.js");
            $.getScript("js/onchangeT01.js");
            $.getScript("js/onchangeP01.js");
            $.getScript("js/onchangeA01.js");
            //if reset tc
            $("#cell_tc_unlock").click(function () {
            $.getScript("js/unlock_tc.js");
            });
            $("#cell_t_unlock").click(function () {
            $.getScript("js/unlock_t01.js");
            $('#idSelect_t').prop('disabled', false);
            $('#idSelect_t').selectpicker('refresh');
            $('#t_lock').css('visibility', 'hidden');
            $('#t_unlock').css('visibility', 'visible');
            $('#idSelect_p').prop('disabled', false);
            $('#idSelect_p').selectpicker('refresh');
            $('#p_lock').css('visibility', 'hidden');
            $('#p_unlock').css('visibility', 'visible');
            $('#idSelect_a').prop('disabled', false);
            $('#idSelect_a').selectpicker('refresh');
            $('#a_lock').css('visibility', 'hidden');
            $('#a_unlock').css('visibility', 'visible');
            $.getScript("js/hide_warning.js");
            //$('#id_form_process').hide();
            $('#id_eid').hide();
            });
            $("#cell_p_unlock").click(function () {
            $.getScript("js/unlock_p01.js");
            $('#idSelect_p').prop('disabled', false);
            $('#idSelect_p').selectpicker('refresh');
            $('#p_lock').css('visibility', 'hidden');
            $('#p_unlock').css('visibility', 'visible');
            $('#idSelect_a').prop('disabled', false);
            $('#idSelect_a').selectpicker('refresh');
            $('#a_lock').css('visibility', 'hidden');
            $('#a_unlock').css('visibility', 'visible');
            $.getScript("js/hide_warning.js"); //$('#id_form_process').hide();
            $('#id_eid').hide();
            });
            $("#cell_a_unlock").click(function () {
            $.getScript("js/unlock_a01.js");
            $('#idSelect_a').prop('disabled', false);
            $('#idSelect_a').selectpicker('refresh');
            $('#a_lock').css('visibility', 'hidden');
            $('#a_unlock').css('visibility', 'visible');
            $.getScript("js/hide_warning.js"); //$('#id_form_process').hide();
            $('#id_eid').hide();
            });
            $('.target').click(function (e) {
            e.preventDefault();
            $.getScript("js/hide_warning.js"); //    $('#id_form_process').hide();
            });
            $('form').submit(function (e) {
            e.preventDefault();
            eventSubmitDate = new Date(Date.now());
            if (($("#idSelect_tc").val() == 1)
                    || ($("#idSelect_t").val() == 1)
                    || ($("#idSelect_p").val() == 1)
                    || ($("#idSelect_a").val() == 1)) {

            $.getScript("js/show_warning.js");
            } else {
            $.getScript("js/hide_warning.js");
            var condition = '';
            var startCondition = "(";
            if ($("#idSelect_tc").val() != 1) {
            cu = "element.cu.value  == " + "'" + $("#idSelect_tc").val() + "'" + "  && ";
            }
            if ($("#idSelect_t").val() != 1) {
            tu = "element.tu.value  == " + "'" + $("#idSelect_t").val() + "'" + "  && ";
            }
            if ($("#idSelect_p").val() != 1) {
            pu = "element.pu.value  == " + "'" + $("#idSelect_p").val() + "'" + "  && ";
            }
            if ($("#idSelect_a").val() != 1) {
            au = "element.au.value  == " + "'" + $("#idSelect_a").val() + "'" + "  && ";
            }
            var endCondition = ")";
            condition = startCondition.concat(cu, tu, pu, au, endCondition).replace(/&&([^'&&']*)$/, '' + '$1');
            $.getJSON(jsonRdfLocation,
                    function (data) {
                    $(data.results.bindings).each(function (index, element) {
                    if (eval(condition)) {
                    let event = new EarsEvent(element);
                    postEventInner(event, function () {
                    $('.sendSuccessOrFailure').css('visibility', 'visible').fadeTo(10000, 1).slideUp(500, function () {

                    });
                    }, function () {
                    $('.sendSuccessOrFailure').css('visibility', 'visible').fadeTo(10000, 1).slideUp(500, function () {

                    });
                    $('.sendSuccessOrFailure').attr("fill", "red");
                    });
                    let map = localStorageEventDefsToMap(); //maps preserve insertion order and have unique entries by default
                    if (map === null) {
                    map = new Map();
                    }
                    if (map.size <= 9) {
                    size = map.size;
                    map.set(event.eventDefinitionId, event);
                    if (map.size != size) { //addition happened, meaning it is new
                    localStorage.eventDefinitions = JSON.stringify(Array.from(map.entries()));
                    }
                    } else { //larger than 9

                    //let firstKey = map.entries().next().value;
                    //map.delete(firstKey);
                    }
                    $("#recentEvents td").empty(); //remove all buttons
                    for (let [key, value] of map) {
                    populateScenario(key);
                    }

                    }
                    });
                    }
            );
            }
            });
            });
            let map = localStorageEventDefsToMap();
            if (map !== null) {
            for (let [key, value] of map) {
            populateScenario(key);
            }
            }
            } else {
            alert("Sorry, your browser does not support local storage.");
            }
        </script>
    </body>
</html>